C51 COMPILER V9.60.0.0   STRAP                                                             12/24/2024 18:55:48 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE STRAP
OBJECT MODULE PLACED IN .\Objects\Strap.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Logic\Strap.c OMF2 OPTIMIZE(9,SPEED) BROWSE INCDIR(.\include;.\StdDriver
                    -\inc;.\Hardware) DEBUG PRINT(.\Listings\Strap.lst) TABS(2) OBJECT(.\Objects\Strap.obj)

line level    source

   1          #include "ADCCfg.h"
   2          #include "Strap.h"
   3          #include "SelfTest.h"
   4          
   5          //全局变量
   6          xdata char VbattCellCount; //系统的电池节数
   7          xdata int TurboCurrent; //极亮模式下的电流
   8          bit Is6VLED; //是否为6V LED
   9          bit IsPosTailKey; //是否为正向尾按
  10          
  11          //配置电阻参数区
  12          code unsigned char StrapResK[]={82,75,68,56,47,33,24,15}; //电阻值(K)
  13          /*****************************************************
  14          LED类型配置为bit field，每1位对应一种阻值的条件下的LED
  15          类型。例如82K的阻值下对应的是6V LED，则对应的第0位为1
  16          75K为0则第二位为0，68K为1则第三位为1。电池类型也以此类
  17          推。3V电池时对应的位为1，6V电池时对应的位为0。
  18          
  19          程序默认配置如下：
  20          82K：3串3.7V三元锂输入，6V LED，极亮14.5A（适用于DFEx-SuperLED+ QV7007I Gen1）
  21          75K：3串3.7V三元锂输入，6V LED，极亮18A（适用于DFEx-SuperLED+ FI1048D Gen1）
  22          68K：3串3.7V三元锂输入，6V LED，极亮10A（适用于SFQ75.3-6V or CREE XHP70.2 or CREE XHP70.3HI/HD）
  23          56K：3串3.7V三元锂输入，3V LED，极亮22A（适用于Luminus SBT90.2 or NBT160.2 or SFQ75.3）
  24          47K：2串3.7V三元锂输入，3V LED，极亮22A（适用于Luminus SBT90.2 or NBT160.2 or SFQ75.3）
  25          33K：2串3.7V三元锂输入，3V LED，极亮12A（适用于N5-235HP或者老批次SFT40 N5145冲刺极限光强）
  26          24K：2串3.7V三元锂输入，3V LED，极亮18A（适用于Luminus SBT90.2标准使用不超功率）
  27          15K：2串3.7V三元锂输入，3V LED，极亮10A（适用于N5-235HP标准使用不超功率）
  28          
  29          *****************************************************/
  30          code unsigned char ITurbo[]={145,180,100,230,230,120,180,100}; //极亮电流(0.1A)
  31          code unsigned char LEDType=0x07;
  32          code unsigned char BattType=0x0F; //电池类型
  33          
  34          //读取Strap
  35          void Strap_Init(void)
  36            {
  37   1        int res,i;  
  38   1        //读取Strap电压并决定是否开启正向尾按
  39   1        SystemTelemHandler();
  40   1        res=Data.CfgStrapRes;
  41   1        //决定尾按类型
  42   1        if(res>100)
  43   1           { 
  44   2           res-=100; //电阻值大于100K时减100K
  45   2           IsPosTailKey=0; //标记为反向开关
  46   2           }
  47   1        else IsPosTailKey=1; //正向开关
  48   1        //决定极亮电流和灯珠电压以及电池节数
  49   1        for(i=0;i<sizeof(StrapResK);i++)
  50   1          {
  51   2          if(res>(int)StrapResK[i]+4||res<(int)StrapResK[i]-4)continue;
  52   2          TurboCurrent=(int)ITurbo[i]*100;
  53   2          VbattCellCount=(BattType&(0x01<<i))?3:2; 
  54   2          Is6VLED=(LEDType&(0x01<<i))?1:0;
C51 COMPILER V9.60.0.0   STRAP                                                             12/24/2024 18:55:48 PAGE 2   

  55   2          return; //找到合法的配置
  56   2          }
  57   1        //合法的Strap列表里面都找过了没找到合适的，报错
  58   1        ReportError(Fault_StrapResistorError);
  59   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    220    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =      3    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
