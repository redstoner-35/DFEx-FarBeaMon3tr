C51 COMPILER V9.60.0.0   MAIN                                                              05/18/2025 17:01:20 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(9,SPEED) BROWSE MODDP2 INCDIR(.\StdDriver\inc;.\Har
                    -dware;.\include\Hardware;.\include\Logic;.\include\Middleware;.\include\System) DEFINE(EnableStdGPIO) DEBUG PRINT(.\List
                    -ings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "cms8s6990.h"
   2          #include "GPIO.h"
   3          #include "delay.h"
   4          #include "SideKey.h"
   5          #include "LEDMgmt.h"
   6          #include "ADCCfg.h"
   7          #include "OutputChannel.h"
   8          #include "PWMCfg.h"
   9          #include "BattDisplay.h"
  10          #include "ModeControl.h"
  11          #include "TempControl.h"
  12          #include "SOS.h"
  13          #include "SelfTest.h"
  14          #include "LowVoltProt.h"
  15          #include "Beacon.h"
  16          #include "LocateLED.h"
  17          #include "Strobe.h"
  18          
  19          //函数声明
  20          void SleepMgmt(void);
  21          
  22          //主函数
  23          void main()
  24            {
  25   1        bit TaskSel=0;
  26   1        //时钟初始化  
  27   1        delay_init();  //延时函数初始化
  28   1        SetSystemHBTimer(1);//启用系统心跳8Hz定时器 
  29   1        //初始化外设
  30   1        OutputChannel_Init(); //启动输出通道  
  31   1        ADC_Init(); //初始化ADC
  32   1        PWM_Init(); //启动PWM定时器
  33   1        LED_Init(); //初始化侧按LED
  34   1        ModeFSMInit(); //初始化挡位状态机
  35   1        SideKeyInit(); //侧按初始化 
  36   1        OutputChannel_TestRun(); //进行输出通道试运行
  37   1        DisplayVBattAtStart(); //显示输出电压
  38   1        EnableADCAsync(); //启动ADC的异步模式提高处理速度
  39   1        //主循环  
  40   1        while(1)
  41   1          {
  42   2          //实时处理
  43   2          SystemTelemHandler();//获取电池信息 
  44   2          SideKey_LogicHandler(); //处理侧按事务
  45   2          BatteryTelemHandler(); //处理电池遥测
  46   2          ModeSwitchFSM(); //挡位状态机
  47   2          ThermalMgmtProcess(); //温度管理函数过热保护等
  48   2          OutputChannel_Calc(); //根据电流进行输出通道控制
  49   2          PWM_OutputCtrlHandler(); //处理PWM输出事务  
  50   2          //8Hz定时处理
  51   2          if(!SysHFBitFlag)continue; //时间没到，跳过处理
  52   2          SysHFBitFlag=0; 
  53   2          //Task0，处理计算量比较大的任务
C51 COMPILER V9.60.0.0   MAIN                                                              05/18/2025 17:01:20 PAGE 2   

  54   2          if(!TaskSel)
  55   2            {
  56   3            RandStrobeHandler(); //处理伪随机爆闪任务
  57   3            ThermalPILoopCalc(); //积分器计算
  58   3            ModeFSMTIMHandler(); //模式状态机计时
  59   3            BeaconFSM_TIMHandler(); //信标模式计时器  
  60   3            LEDControlHandler();//侧按指示LED控制函数
  61   3            OCFSM_TIMHandler(); //输出通道状态机计时
  62   3            HoldSwitchGearCmdHandler(); //长按换挡
  63   3            SideKey_TIM_Callback();//侧按按键的监测定时器处理
  64   3            //处理结束，对任务选择进行翻转处理下一组
  65   3            TaskSel=1;
  66   3            }     
  67   2          //Task1，处理计算量比较小的计时任务
  68   2          else
  69   2            {     
  70   3            OutputFaultDetect();//输出故障检测
  71   3            BattDisplayTIM(); //电池电量显示TIM
  72   3            SOSTIMHandler(); //SOS计时器
  73   3            BattAlertTIMHandler(); //电池警报定时处理
  74   3            DisplayErrorTIMHandler(); //故障代码显示
  75   3            SleepMgmt(); //休眠管理
  76   3            LocateLED_TIMHandler(); //定位LED计时
  77   3            //处理结束，对任务选择进行翻转处理下一组
  78   3            TaskSel=0;
  79   3            }
  80   2          }
  81   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    121    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
